---
title: "Barcode Diversity"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
```

## Creating matrix i hope?

```{r }
library_size=1000
OGcounts <- data.frame("Cell_ID"= c(seq(1,library_size))) %>% add_column(gr= rnorm(nrow(.), mean=0.022, sd=0.004)) %>% add_column(counts= c(rep(1,library_size)))%>% mutate(abund= OGcounts$counts/sum(OGcounts$counts))

 

```


```{r }
prob_cellsort_death=0.15

#sample(x=x, size=n, prob=p)

cells_lost_sort= sample(x=OGcounts$Cell_ID, size=round(prob_cellsort_death*sum(OGcounts$counts)), prob =OGcounts$abund )

```

```{r}
`%not in%` <- negate(`%in%`)
SortMatrix<- OGcounts[OGcounts$Cell_ID %not in% cells_lost_sort,]

```
```{r}
# function to solve a logistic growth equation for the final number of cells given growth rate, starting number of cells, carrying capacity and the final time point
solveN <- function(g, N0, tfinal, k){
Nfinal <- (k*N0)/N0+(k-N0)*exp(g*tfinal)
return(Nfinal)
}
# function to solve a logistic growth equation for the final time given growth rate, starting number of cells, carrying capacity, and the final number of cells
solvet <- function(g, N0, Nfinal, k){
  tfinal <- -(ln((N0*(1-(k/Nfinal)))/(N0-k)))/g
  return(tfinal)
}
```

```{r}
SortMeangr= mean(SortMatrix$gr)
days= solvet(SortMeangr,sum(SortMatrix$counts), 50e3, k=55e3)

```


```{r}
SortMatrix %>% select(-abund) %>% mutate(counts= floor(solveN(SortMatrix$gr,SortMatrix$counts,days)))%>% mutate(abund= counts/sum(SortMatrix$counts))

```

